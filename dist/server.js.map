{"version":3,"sources":["../server/server.js"],"names":["install","port","process","env","PORT","app","use","static","json","db","get","req","res","filter","query","status","collection","find","toArray","then","issues","metadata","total_count","length","_metadata","records","catch","error","console","log","message","post","newIssue","body","created","Date","err","validateIssue","insertOne","doc","_id","insertedId","limit","next","connect","MONGODB_URI","connection","listen"],"mappings":";;AAAA;;;;AACA;;;;AACA;;AACA;;;;AAEA;;AAEA;;;;;;AAHA;AAIA,2BAAiBA,OAAjB;AAFA;;;AAIA,MAAMC,OAAOC,QAAQC,GAAR,CAAYC,IAAZ,IAAoB,IAAjC;AACA,MAAMC,MAAM,wBAAZ;AACAA,IAAIC,GAAJ,CAAQ,kBAAQC,MAAR,CAAe,QAAf,CAAR;AACAF,IAAIC,GAAJ,CAAQ,qBAAWE,IAAX,EAAR;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,IAAIC,EAAJ;;AAEAJ,IAAIK,GAAJ,CAAQ,cAAR,EAAwB,CAACC,GAAD,EAAMC,GAAN,KAAc;AAClC,UAAMC,SAAS,EAAf;AACA,QAAGF,IAAIG,KAAJ,CAAUC,MAAb,EAAqBF,OAAOE,MAAP,GAAgBJ,IAAIG,KAAJ,CAAUC,MAA1B;AACrBN,OAAGO,UAAH,CAAc,QAAd,EAAwBC,IAAxB,CAA6BJ,MAA7B,EAAqCK,OAArC,GAA+CC,IAA/C,CAAoDC,UAAU;AAC1D,cAAMC,WAAW,EAACC,aAAaF,OAAOG,MAArB,EAAjB;AACAX,YAAIJ,IAAJ,CAAS,EAACgB,WAAWH,QAAZ,EAAsBI,SAASL,MAA/B,EAAT;AACH,KAHD,EAGGM,KAHH,CAGSC,SAAS;AACdC,gBAAQC,GAAR,CAAYF,KAAZ;AACAf,YAAIG,MAAJ,CAAW,GAAX,EAAgBP,IAAhB,CAAqB,EAACsB,SAAU,0BAAyBH,KAAM,EAA1C,EAArB;AACH,KAND;AAOH,CAVD;;AAYAtB,IAAI0B,IAAJ,CAAS,aAAT,EAAwB,CAACpB,GAAD,EAAMC,GAAN,KAAc;AAClC,UAAMoB,WAAWrB,IAAIsB,IAArB;AACAD,aAASE,OAAT,GAAmB,IAAIC,IAAJ,EAAnB;AACA,QAAG,CAACH,SAASjB,MAAb,EAAoB;AAChBiB,iBAASjB,MAAT,GAAkB,KAAlB;AACH;AACD,UAAMqB,MAAM,gBAAMC,aAAN,CAAoBL,QAApB,CAAZ;AACA,QAAGI,GAAH,EAAO;AACHxB,YAAIG,MAAJ,CAAW,GAAX,EAAgBP,IAAhB,CAAqB,EAACsB,SAAU,oBAAmBM,GAAI,EAAlC,EAArB;AACA;AACH;;AAED3B,OAAGO,UAAH,CAAc,QAAd,EAAwBsB,SAAxB,CAAkCN,QAAlC,EAA4Cb,IAA5C,CAAiDoB,OAC7C9B,GAAGO,UAAH,CAAc,QAAd,EAAwBC,IAAxB,CAA6B,EAACuB,KAAKD,IAAIE,UAAV,EAA7B,EAAoDC,KAApD,CAA0D,CAA1D,EAA6DC,IAA7D,EADJ,EAEExB,IAFF,CAEOa,YAAY;AACfpB,YAAIJ,IAAJ,CAASwB,QAAT;AACH,KAJD,EAIGN,KAJH,CAISC,SAAS;AACdC,gBAAQC,GAAR,CAAYF,KAAZ;AACAf,YAAIG,MAAJ,CAAW,GAAX,EAAgBP,IAAhB,CAAqB,EAACsB,SAAU,0BAAyBH,KAAM,EAA1C,EAArB;AACH,KAPD;AAQH,CApBD;;AAwBA,qBAAYiB,OAAZ,CAAoB1C,QAAQC,GAAR,CAAY0C,WAAZ,IAA2B,kCAA/C,EAAmF1B,IAAnF,CAAwF2B,cAAc;AAClGrC,SAAKqC,UAAL;AACAzC,QAAI0C,MAAJ,CAAW9C,IAAX,EAAiB,MAAM;AACnB2B,gBAAQC,GAAR,CAAa,uBAAsB5B,IAAK,EAAxC;AACH,KAFD;AAGH,CALD,EAKGyB,KALH,CAKSU,OAAO;AACZR,YAAQC,GAAR,CAAY,QAAZ,EAAsBO,GAAtB;AACH,CAPD","file":"server.js","sourcesContent":["import express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport {MongoClient} from 'mongodb';\r\nimport Issue from './issue.js';\r\n//Necessary for transfiling of es2015\r\nimport 'babel-polyfill';\r\n//Necessary for Node.js to report line numbers of source file instead of the compiled file\r\nimport SourceMapSupport from 'source-map-support';\r\nSourceMapSupport.install();\r\n\r\nconst port = process.env.PORT || 3000;\r\nconst app = express();\r\napp.use(express.static('static'));\r\napp.use(bodyParser.json());\r\n\r\n\r\n// if(process.env.NODE_ENV !== 'production'){\r\n//     const webpack = require('webpack');\r\n//     const webpackDevMiddleware = require('webpack-dev-middleware');\r\n//     const webpackHotMiddleware = require('webpack-hot-middleware');\r\n\r\n//     const config = require('../webpack.config');\r\n//     config.entry.app.push('webpack-hot-middleware/client',\r\n//             'webpack/hot/only-dev-server');\r\n//     config.plugins.push(new webpack.HotModuleReplacementPlugin());\r\n    \r\n//     const bundler = webpack(config);\r\n//     app.use(webpackDevMiddleware(bundler, {noInfo: true}));\r\n//     app.use(webpackHotMiddleware(bundler, {log: console.log}));\r\n// }\r\n\r\nlet db;\r\n\r\napp.get('/api/issues/', (req, res) => {\r\n    const filter = {};\r\n    if(req.query.status) filter.status = req.query.status;\r\n    db.collection('issues').find(filter).toArray().then(issues => {\r\n        const metadata = {total_count: issues.length}\r\n        res.json({_metadata: metadata, records: issues});\r\n    }).catch(error => {\r\n        console.log(error);\r\n        res.status(500).json({message: `Internal Server Error: ${error}`});\r\n    });\r\n});\r\n\r\napp.post('/api/issues', (req, res) => {\r\n    const newIssue = req.body;\r\n    newIssue.created = new Date();\r\n    if(!newIssue.status){\r\n        newIssue.status = 'New';\r\n    }\r\n    const err = Issue.validateIssue(newIssue);\r\n    if(err){\r\n        res.status(422).json({message: `Invalid request: ${err}`});\r\n        return;\r\n    }\r\n\r\n    db.collection('issues').insertOne(newIssue).then(doc => \r\n        db.collection('issues').find({_id: doc.insertedId}).limit(1).next()\r\n    ).then(newIssue => {\r\n        res.json(newIssue);\r\n    }).catch(error => {\r\n        console.log(error);\r\n        res.status(500).json({message: `Internal Server Error: ${error}`});\r\n    });\r\n});\r\n\r\n\r\n\r\nMongoClient.connect(process.env.MONGODB_URI || 'mongodb://localhost/issuetracker').then(connection => {\r\n    db = connection;\r\n    app.listen(port, () => {\r\n        console.log(`App started on port ${port}`);\r\n    });\r\n}).catch(err => {\r\n    console.log('ERROR:', err);\r\n});"]}